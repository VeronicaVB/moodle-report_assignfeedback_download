{"version":3,"sources":["../src/report_control.js"],"names":["define","Controls","userids","useritemids","self","prototype","main","selectbyone","selectallaction","instanceids","document","querySelector","getAttribute","getElementById","value","t","Array","from","rows","forEach","tr","checkbox","cells","firstChild","addEventListener","selectbyonehandler","bind","selectall","selectallhandler","s","checked","users","split","userid","length","innertable","uitemids","pop","push","includes","index","indexOf","splice","aux","filter","el","form","selectedusers","JSON","stringify","disabled","e","target","id","usersummary","selectedall","init","Y","log","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Defines the APIs used by log reports\n *\n * @package    report\n * @subpackage ibassessmentreport\n * @copyright  2021 Veronica Bermegui\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\"jquery\", \"core/ajax\", \"core/log\"], function ($, Ajax, Log) {\n  \"use strict\";\n\n  function init() {\n    Y.log(\"assignfeedback_download control...\");\n\n    let userids = [];\n    let useritemids = [];\n    var control = new Controls(userids, useritemids);\n    control.main();\n  }\n\n  function Controls(userids, useritemids) {\n    let self = this;\n    self.userids = userids;\n    self.useritemids = useritemids;\n  }\n\n  /**\n   * Run the controller.\n   *\n   */\n  Controls.prototype.main = function () {\n    let self = this;\n\n    self.selectbyone();\n    self.selectallaction();\n\n    const instanceids = document\n      .querySelector(\"table.assignfeedback_download\")\n      .getAttribute(\"data-selected-assign\");\n    document\n      .getElementById(\"downloadactionform\")\n      .querySelector('input[name=\"instanceids\"]').value = instanceids;\n  };\n\n  Controls.prototype.selectbyone = function () {\n    let self = this;\n    let t = document.getElementById(\"iassignfeedbacktb\");\n    if (t) {\n      //  Collect all the users ids\n      Array.from(t.rows).forEach((tr) => {\n        const checkbox = tr.cells[0].firstChild;\n        checkbox.addEventListener(\n          \"click\",\n          self.selectbyonehandler.bind(self, this)\n        );\n      });\n    }\n  };\n\n  Controls.prototype.selectallaction = function () {\n    let self = this;\n    let selectall = document.getElementById(\"selectall\");\n    selectall.addEventListener(\"click\", self.selectallhandler.bind(self, this));\n  };\n\n  Controls.prototype.selectallhandler = function (s, e) {\n    let t = document.getElementById(\"iassignfeedbacktb\");\n    if (t) {\n      Array.from(t.rows).forEach((tr) => {\n        const checkbox = tr.cells[0].firstChild;\n        checkbox.checked = !checkbox.checked;\n        const users = checkbox.getAttribute(\"id\").split(\"_\");\n        const userid = users[users.length - 1];\n        const innertable = document.getElementById(`innertable_${userid}`);\n        const uitemids = innertable\n          .getAttribute(\"data-user-grade-id\")\n          .split(\",\");\n        uitemids.pop(); // Remove the last empty item.\n        const usersummary = { userid: userid, uitemids: uitemids };\n        s.useritemids.push(usersummary);\n        if (!checkbox.checked && s.userids.includes(userid)) {\n          const index = s.userids.indexOf(userid);\n          if (index > -1) {\n            s.userids.splice(index, 1);\n\n            const aux = s.useritemids;\n            s.useritemids = aux.filter(function (el) {\n              if (el.userid != userid) {\n                return el;\n              }\n            }, userid);\n          }\n        } else {\n          s.userids.push(users[users.length - 1]);\n        }\n      });\n    }\n\n    let form = document.getElementById(\"downloadactionform\");\n    let selectedusers = form.querySelector('input[name=\"selectedusers\"]');\n    let useritemids = form.querySelector('input[name=\"itemids\"]');\n    selectedusers.value = s.userids;\n    useritemids.value = JSON.stringify(s.useritemids);\n\n    // Enable the download select only if there are selected users.\n    if (selectedusers.value) {\n      document.getElementById(\"id_operation\").disabled = false;\n      document.getElementById(\"id_submit\").disabled = false;\n    } else {\n      document.getElementById(\"id_operation\").disabled = true;\n      document.getElementById(\"id_submit\").disabled = true;\n    }\n  };\n\n  Controls.prototype.selectbyonehandler = function (s, e) {\n    let userid = e.target.id;\n    userid = userid.split(\"_\");\n    userid = userid[userid.length - 1];\n    const innertable = document.getElementById(`innertable_${userid}`);\n    const uitemids = innertable.getAttribute(\"data-user-grade-id\").split(\",\");\n    uitemids.pop(); // Remove the last empty item.\n    const usersummary = { userid: userid, uitemids: uitemids };\n    s.useritemids.push(usersummary);\n    const selectedall = document.getElementById(\"selectall\");\n\n    if (selectedall.checked) {\n      document.getElementById(\"selectall\").checked = false;\n    }\n\n    if (!e.target.checked && s.userids.includes(userid)) {\n      const index = s.userids.indexOf(userid);\n      if (index > -1) {\n        s.userids.splice(index, 1);\n        const aux = s.useritemids;\n            s.useritemids = aux.filter(function (el) {\n              if (el.userid != userid) {\n                return el;\n              }\n            }, userid);\n      }\n    } else {\n      s.userids.push(userid);\n    }\n\n    let form = document.getElementById(\"downloadactionform\");\n    let selectedusers = form.querySelector('input[name=\"selectedusers\"]');\n    let useritemids = form.querySelector('input[name=\"itemids\"]');\n    selectedusers.value = s.userids;\n    useritemids.value = JSON.stringify(s.useritemids);\n\n    if (selectedusers.value) {\n      document.getElementById(\"id_operation\").disabled = false;\n      document.getElementById(\"id_submit\").disabled = false;\n    } else {\n      document.getElementById(\"id_operation\").disabled = true;\n      document.getElementById(\"id_submit\").disabled = true;\n    }\n  };\n\n  return { init: init };\n});\n"],"file":"report_control.min.js"}