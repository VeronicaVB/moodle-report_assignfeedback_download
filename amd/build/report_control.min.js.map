{"version":3,"sources":["../src/report_control.js"],"names":["define","Controls","userids","useritemids","self","frcollection","Map","prototype","main","selectbyone","selectallaction","instanceids","document","querySelector","getAttribute","getElementById","value","cmids","t","Array","from","rows","forEach","tr","checkbox","cells","firstChild","addEventListener","selectbyonehandler","bind","selectall","selectallhandler","s","countusers","selectallcheckstatus","checked","form","selectedusers","frubricdetails","users","split","userid","length","innertable","uitemids","pop","push","includes","index","indexOf","splice","aux","filter","el","delete","JSON","stringify","Object","fromEntries","innertabletr","i","children","has","set","frcontainer","firstElementChild","get","disabled","e","target","id","usersummary","selectedall","init","Y","log","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *\n *\n * @package    report\n * @subpackage ibassessmentreport\n * @copyright  2021 Veronica Bermegui\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n define([\"jquery\", \"core/ajax\", \"core/log\", \"report_assignfeedback_download/html2pdf\"], function ($, Ajax, Log, html2pdf) {\n    \"use strict\";\n\n    function init() {\n        Y.log(\"assignfeedback_download control...\");\n\n        let userids = [];\n        let useritemids = [];\n        var control = new Controls(userids, useritemids);\n        control.main();\n    }\n\n    function Controls(userids, useritemids) {\n        let self = this;\n        self.userids = userids;\n        self.useritemids = useritemids;\n        self.frcollection = new Map();\n\n    }\n\n    /**\n     * Run the controller.\n     *\n     */\n    Controls.prototype.main = function () {\n        let self = this;\n\n        self.selectbyone();\n        self.selectallaction();\n        //  self.rubricaction();  TODO: The  framework isnt downloading with the same style as the one in PHP. First version wont download\n\n        const instanceids = document\n            .querySelector(\"table.assignfeedback_download\")\n            .getAttribute(\"data-selected-assign\");\n        document\n            .getElementById(\"downloadactionform\")\n            .querySelector('input[name=\"instanceids\"]').value = instanceids;\n        const cmids = document\n            .querySelector(\"table.assignfeedback_download\")\n            .getAttribute(\"data-selected-cmid\");\n        document\n            .getElementById(\"downloadactionform\")\n            .querySelector('input[name=\"cmids\"]').value = cmids;\n\n        //  self.downloadrubric();\n\n        //  document.getElementById(\"rubrictestdownload\").addEventListener(\"click\", self.downloadrubric);\n\n    };\n\n    Controls.prototype.selectbyone = function () {\n        let self = this;\n        let t = document.getElementById(\"iassignfeedbacktb\");\n        if (t) {\n            //  Collect all the users ids\n            Array.from(t.rows).forEach((tr) => {\n                const checkbox = tr.cells[0].firstChild;\n                checkbox.addEventListener(\n                    \"click\",\n                    self.selectbyonehandler.bind(self, this)\n                );\n            });\n        }\n    };\n\n    Controls.prototype.selectallaction = function () {\n        let self = this;\n        let selectall = document.getElementById(\"selectall\");\n        selectall.addEventListener(\"click\", self.selectallhandler.bind(self, this));\n    };\n\n    Controls.prototype.selectallhandler = function (s, e) {\n        let t = document.getElementById(\"iassignfeedbacktb\");\n        let countusers = 0;\n        const selectallcheckstatus = document.getElementById(\"selectall\").checked;\n        //let frcollection = new Map();\n        let form = document.getElementById(\"downloadactionform\");\n        let selectedusers = form.querySelector('input[name=\"selectedusers\"]');\n        let useritemids = form.querySelector('input[name=\"itemids\"]');\n        let frubricdetails = form.querySelector('input[name=\"frubricdetails\"]');\n\n        if (t) {\n            Array.from(t.rows).forEach((tr) => {\n                const checkbox = tr.cells[0].firstChild;\n                checkbox.checked = selectallcheckstatus;\n                const users = checkbox.getAttribute(\"id\").split(\"_\");\n                const userid = users[users.length - 1];\n                const innertable = document.getElementById(`innertable_${userid}`);\n                const uitemids = innertable\n                    .getAttribute(\"data-user-grade-id\")\n                    .split(\",\");\n                uitemids.pop(); // Remove the last empty item.\n                const usersummary = {\n                    userid: userid,\n                    uitemids: uitemids,\n\n                };\n\n                s.useritemids.push(usersummary);\n                countusers++;\n\n                if (!checkbox.checked && s.userids.includes(userid)) {\n                    const index = s.userids.indexOf(userid);\n                    if (index > -1) {\n                        s.userids.splice(index, 1);\n                        const aux = s.useritemids;\n\n                        s.useritemids = aux.filter(function (el) {\n                            if (el.userid != userid) {\n                                return el;\n                            }\n                        }, userid);\n                        // Remove from Frubric\n                        s.frcollection.delete(userid);\n                        frubricdetails.value = JSON.stringify(Object.fromEntries(s.frcollection));\n                    }\n\n                } else if (checkbox.checked && !s.userids.includes(userid)) {\n                    s.userids.push(users[users.length - 1]);\n                    // Check FRubric\n                    const innertabletr = document.getElementById(`innertable_${userid}`).querySelector('tbody');\n                    for (let i = 0; i < innertabletr.rows.length; i++) {\n                        if (innertabletr.rows[i].cells[6].children.length > 0) { // It has  a rubric\n                            if (!s.frcollection.has(userid)) {\n                                s.frcollection.set(userid, []);\n                            }\n                            const frcontainer = innertabletr.rows[i].cells[6].firstElementChild;\n                            s.frcollection.get(userid).push(frcontainer.getAttribute('data-frubric-params'));\n                        }\n                    }\n\n                    frubricdetails.value = JSON.stringify(Object.fromEntries(s.frcollection));\n                }\n\n\n            });\n\n            if (!selectallcheckstatus) {\n                s.userids = []; // Clear the array.\n            }\n\n            if (countusers == s.userids.length) {\n                (document.getElementById(\"id_operation\").children[0]).disabled = false;\n            } else {\n                (document.getElementById(\"id_operation\").children[0]).disabled = true;\n            }\n\n        }\n\n        selectedusers.value = s.userids;\n        useritemids.value = JSON.stringify(s.useritemids);\n\n\n\n        // Enable the download select only if there are selected users.\n        if (selectedusers.value) {\n            document.getElementById(\"id_operation\").disabled = false;\n            document.getElementById(\"id_submit\").disabled = false;\n        } else {\n            document.getElementById(\"id_operation\").disabled = true;\n            document.getElementById(\"id_submit\").disabled = true;\n        }\n    };\n\n    Controls.prototype.selectbyonehandler = function (s, e) {\n        let userid = e.target.id;\n        userid = userid.split(\"_\");\n        userid = userid[userid.length - 1];\n        const innertable = document.getElementById(`innertable_${userid}`);\n        const uitemids = innertable.getAttribute(\"data-user-grade-id\").split(\",\");\n        uitemids.pop(); // Remove the last empty item.\n        const usersummary = {\n            userid: userid,\n            uitemids: uitemids\n        };\n\n        s.useritemids.push(usersummary);\n        const selectedall = document.getElementById(\"selectall\");\n\n        let form = document.getElementById(\"downloadactionform\");\n        let frubricdetails = form.querySelector('input[name=\"frubricdetails\"]');\n\n        if (selectedall.checked) {\n            document.getElementById(\"selectall\").checked = false;\n        }\n\n        if (!e.target.checked && s.userids.includes(userid)) {\n            const index = s.userids.indexOf(userid);\n            if (index > -1) {\n                s.userids.splice(index, 1);\n                const aux = s.useritemids;\n                s.useritemids = aux.filter(function (el) {\n                    if (el.userid != userid) {\n                        return el;\n                    }\n                }, userid);\n\n                // Remove from Frubric\n                s.frcollection.delete(userid);\n                frubricdetails.value = JSON.stringify(Object.fromEntries(s.frcollection));\n            }\n        } else {\n            s.userids.push(userid);\n            // Check FRubric\n            for (let i = 0; i < innertable.rows.length; i++) {\n                if (innertable.rows[i].cells[6].children.length > 0) { // It has  a rubric\n                    if (!s.frcollection.has(userid)) {\n                        s.frcollection.set(userid, []);\n                    }\n                    const frcontainer = innertable.rows[i].cells[6].firstElementChild;\n                    s.frcollection.get(userid).push(frcontainer.getAttribute('data-frubric-params'));\n                }\n            }\n\n\n            frubricdetails.value = JSON.stringify(Object.fromEntries(s.frcollection));\n        }\n\n\n        let selectedusers = form.querySelector('input[name=\"selectedusers\"]');\n        let useritemids = form.querySelector('input[name=\"itemids\"]');\n        selectedusers.value = s.userids;\n        useritemids.value = JSON.stringify(s.useritemids);\n\n\n        if (selectedusers.value) {\n            document.getElementById(\"id_operation\").disabled = false;\n            document.getElementById(\"id_submit\").disabled = false;\n        } else {\n            document.getElementById(\"id_operation\").disabled = true;\n            document.getElementById(\"id_submit\").disabled = true;\n        }\n    };\n\n    // Controls.prototype.rubricaction = function () {\n    //     Y.log('rubricaction');\n    //     const self = this;\n    //     let t = document.getElementById(\"iassignfeedbacktb\");\n\n    //     if (t) {\n\n    //         Array.from(t.rows).forEach((tr) => {\n    //             const checkbox = tr.cells[0].firstChild;\n    //             const user = checkbox.getAttribute(\"id\").split(\"_\");\n    //             const userid = user[user.length - 1];\n    //             const innertabletr = document.getElementById(`innertable_${userid}`).querySelector('tbody');\n\n    //             for (let i = 0; i < innertabletr.rows.length; i++) {\n    //                 if (innertabletr.rows[i].cells[5].children.length > 0) { // It has  a rubric\n    //                     const frcontainer = innertabletr.rows[i].cells[5].firstElementChild;\n    //                     frcontainer.addEventListener('click', self.downloadrubric);\n\n    //                 }\n    //             }\n    //         }, self);\n    //     }\n    // }\n\n    return {\n        init: init\n    };\n});"],"file":"report_control.min.js"}