define ("report_assignfeedback_download/report_control",["jquery","core/ajax","core/log","report_assignfeedback_download/html2pdf"],function(){"use strict";function a(a,b){var c=this;c.userids=a;c.useritemids=b;c.frcollection=new Map}a.prototype.main=function(){var a=this;a.selectbyone();a.selectallaction();var b=document.querySelector("table.assignfeedback_download").getAttribute("data-selected-assign");document.getElementById("downloadactionform").querySelector("input[name=\"instanceids\"]").value=b;var c=document.querySelector("table.assignfeedback_download").getAttribute("data-selected-cmid");document.getElementById("downloadactionform").querySelector("input[name=\"cmids\"]").value=c};a.prototype.selectbyone=function(){var a=this,b=this,c=document.getElementById("iassignfeedbacktb");if(c){Array.from(c.rows).forEach(function(c){var d=c.cells[0].firstChild;d.addEventListener("click",b.selectbyonehandler.bind(b,a))})}};a.prototype.selectallaction=function(){var a=this,b=document.getElementById("selectall");b.addEventListener("click",a.selectallhandler.bind(a,this))};a.prototype.selectallhandler=function(a){var b=document.getElementById("iassignfeedbacktb"),c=0,d=document.getElementById("selectall").checked,e=document.getElementById("downloadactionform"),f=e.querySelector("input[name=\"selectedusers\"]"),g=e.querySelector("input[name=\"itemids\"]"),h=e.querySelector("input[name=\"frubricdetails\"]");if(b){Array.from(b.rows).forEach(function(b){var e=b.cells[0].firstChild;e.checked=d;var f=e.getAttribute("id").split("_"),g=f[f.length-1],j=document.getElementById("innertable_".concat(g)),k=j.getAttribute("data-user-grade-id").split(",");k.pop();a.useritemids.push({userid:g,uitemids:k});c++;if(!e.checked&&a.userids.includes(g)){var n=a.userids.indexOf(g);if(-1<n){a.userids.splice(n,1);var o=a.useritemids;a.useritemids=o.filter(function(a){if(a.userid!=g){return a}},g);a.frcollection.delete(g);h.value=JSON.stringify(Object.fromEntries(a.frcollection))}}else if(e.checked&&!a.userids.includes(g)){a.userids.push(f[f.length-1]);for(var l=document.getElementById("innertable_".concat(g)).querySelector("tbody"),m=0;m<l.rows.length;m++){if(0<l.rows[m].cells[6].children.length){if(!a.frcollection.has(g)){a.frcollection.set(g,[])}var p=l.rows[m].cells[6].firstElementChild;a.frcollection.get(g).push(p.getAttribute("data-frubric-params"))}}h.value=JSON.stringify(Object.fromEntries(a.frcollection))}});if(!d){a.userids=[]}if(c==a.userids.length){document.getElementById("id_operation").children[0].disabled=!1}else{document.getElementById("id_operation").children[0].disabled=!0}}f.value=a.userids;g.value=JSON.stringify(a.useritemids);if(f.value){document.getElementById("id_operation").disabled=!1;document.getElementById("id_submit").disabled=!1}else{document.getElementById("id_operation").disabled=!0;document.getElementById("id_submit").disabled=!0}};a.prototype.selectbyonehandler=function(a,b){var c=b.target.id;c=c.split("_");c=c[c.length-1];var d=document.getElementById("innertable_".concat(c)),e=d.getAttribute("data-user-grade-id").split(",");e.pop();var f={userid:c,uitemids:e};a.useritemids.push(f);var g=document.getElementById("selectall"),h=document.getElementById("downloadactionform"),j=h.querySelector("input[name=\"frubricdetails\"]");if(g.checked){document.getElementById("selectall").checked=!1}if(!b.target.checked&&a.userids.includes(c)){var m=a.userids.indexOf(c);if(-1<m){a.userids.splice(m,1);var n=a.useritemids;a.useritemids=n.filter(function(a){if(a.userid!=c){return a}},c);a.frcollection.delete(c);j.value=JSON.stringify(Object.fromEntries(a.frcollection))}}else{a.userids.push(c);for(var o=0;o<d.rows.length;o++){if(0<d.rows[o].cells[6].children.length){if(!a.frcollection.has(c)){a.frcollection.set(c,[])}var i=d.rows[o].cells[6].firstElementChild;a.frcollection.get(c).push(i.getAttribute("data-frubric-params"))}}j.value=JSON.stringify(Object.fromEntries(a.frcollection))}var k=h.querySelector("input[name=\"selectedusers\"]"),l=h.querySelector("input[name=\"itemids\"]");k.value=a.userids;l.value=JSON.stringify(a.useritemids);if(k.value){document.getElementById("id_operation").disabled=!1;document.getElementById("id_submit").disabled=!1}else{document.getElementById("id_operation").disabled=!0;document.getElementById("id_submit").disabled=!0}};return{init:function(){Y.log("assignfeedback_download control...");var b=new a([],[]);b.main()}}});
//# sourceMappingURL=report_control.min.js.map
