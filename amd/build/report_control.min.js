define ("report_assignfeedback_download/report_control",["jquery","core/ajax","core/log","report_assignfeedback_download/html2pdf"],function(a,b,c,d){"use strict";function e(a,b){var c=this;c.userids=a;c.useritemids=b}e.prototype.main=function(){var a=this;a.selectbyone();a.selectallaction();a.rubricaction();var b=document.querySelector("table.assignfeedback_download").getAttribute("data-selected-assign");document.getElementById("downloadactionform").querySelector("input[name=\"instanceids\"]").value=b};e.prototype.selectbyone=function(){var a=this,b=this,c=document.getElementById("iassignfeedbacktb");if(c){Array.from(c.rows).forEach(function(c){var d=c.cells[0].firstChild;d.addEventListener("click",b.selectbyonehandler.bind(b,a))})}};e.prototype.selectallaction=function(){var a=this,b=document.getElementById("selectall");b.addEventListener("click",a.selectallhandler.bind(a,this))};e.prototype.selectallhandler=function(a){var b=document.getElementById("iassignfeedbacktb");if(b){Array.from(b.rows).forEach(function(b){var c=b.cells[0].firstChild;c.checked=!c.checked;var d=c.getAttribute("id").split("_"),e=d[d.length-1],f=document.getElementById("innertable_".concat(e)),g=f.getAttribute("data-user-grade-id").split(",");g.pop();a.useritemids.push({userid:e,uitemids:g});if(!c.checked&&a.userids.includes(e)){var h=a.userids.indexOf(e);if(-1<h){a.userids.splice(h,1);var i=a.useritemids;a.useritemids=i.filter(function(a){if(a.userid!=e){return a}},e)}}else{a.userids.push(d[d.length-1])}})}var c=document.getElementById("downloadactionform"),d=c.querySelector("input[name=\"selectedusers\"]"),e=c.querySelector("input[name=\"itemids\"]");d.value=a.userids;e.value=JSON.stringify(a.useritemids);if(d.value){document.getElementById("id_operation").disabled=!1;document.getElementById("id_submit").disabled=!1}else{document.getElementById("id_operation").disabled=!0;document.getElementById("id_submit").disabled=!0}};e.prototype.selectbyonehandler=function(a,b){var c=b.target.id;c=c.split("_");c=c[c.length-1];var d=document.getElementById("innertable_".concat(c)),e=d.getAttribute("data-user-grade-id").split(",");e.pop();var f={userid:c,uitemids:e};a.useritemids.push(f);var g=document.getElementById("selectall");if(g.checked){document.getElementById("selectall").checked=!1}if(!b.target.checked&&a.userids.includes(c)){var k=a.userids.indexOf(c);if(-1<k){a.userids.splice(k,1);var l=a.useritemids;a.useritemids=l.filter(function(a){if(a.userid!=c){return a}},c)}}else{a.userids.push(c)}var h=document.getElementById("downloadactionform"),i=h.querySelector("input[name=\"selectedusers\"]"),j=h.querySelector("input[name=\"itemids\"]");i.value=a.userids;j.value=JSON.stringify(a.useritemids);if(i.value){document.getElementById("id_operation").disabled=!1;document.getElementById("id_submit").disabled=!1}else{document.getElementById("id_operation").disabled=!0;document.getElementById("id_submit").disabled=!0}};e.prototype.rubricaction=function(){Y.log("rubricaction");var a=this,b=document.getElementById("iassignfeedbacktb");if(b){Array.from(b.rows).forEach(function(b){for(var c=b.cells[0].firstChild,d=c.getAttribute("id").split("_"),e=d[d.length-1],f=document.getElementById("innertable_".concat(e)).querySelector("tbody"),g=0;g<f.rows.length;g++){if(0<f.rows[g].cells[5].children.length){var h=f.rows[g].cells[5].firstElementChild;h.addEventListener("click",a.downloadrubric)}}},a)}};e.prototype.downloadrubric=function(a){Y.log(a.currentTarget);var b=a.currentTarget.getAttribute("data-frubric-filling"),c=a.currentTarget.getAttribute("data-rubric-file-name");if(""!=b){b=JSON.parse(b);var f=b.split("</div>");var e=f[f.length-1];b=b.replace(e,"<br> <strong>TOTAL: "+e+"</strong>");d().set({margin:1,filename:c,pagebreak:{mode:"legacy"},html2canvas:{scrollX:0,scrollY:0}}).from(b).save()}};return{init:function(){Y.log("assignfeedback_download control...");var a=new e([],[]);a.main()}}});
//# sourceMappingURL=report_control.min.js.map
